<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Aggregation Framework | Pinternship</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Aggregation Framework" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1. Problem Statement" />
<meta property="og:description" content="1. Problem Statement" />
<link rel="canonical" href="http://localhost:4001/pinternship/case-studies/01-aggregation-framework/" />
<meta property="og:url" content="http://localhost:4001/pinternship/case-studies/01-aggregation-framework/" />
<meta property="og:site_name" content="Pinternship" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-01-28T21:55:57+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Aggregation Framework" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2026-01-28T21:55:57+05:30","datePublished":"2026-01-28T21:55:57+05:30","description":"1. Problem Statement","headline":"Aggregation Framework","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4001/pinternship/case-studies/01-aggregation-framework/"},"url":"http://localhost:4001/pinternship/case-studies/01-aggregation-framework/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/pinternship/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4001/pinternship/feed.xml" title="Pinternship" /></head>
<head><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-87W6B0JP70"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-87W6B0JP70');
</script></head>
  <body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/pinternship/">Pinternship</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/pinternship/intro/">Introduction</a><a class="page-link" href="/pinternship/case-studies/">Case Studies</a><a class="page-link" href="/pinternship/projects/">Projects</a><div class="dropdown">
                <input type="checkbox" id="dropdown-trigger-activity" class="dropdown-trigger" />
                <label for="dropdown-trigger-activity" class="dropbtn">Activity</label>
                <div class="dropdown-content"><a href="/pinternship/linkedin_post/">LinkedIn Post</a><a href="/pinternship/blogs/">Blogs</a><a href="/pinternship/vlogs/">Vlogs</a><a href="/pinternship/endorsements/">Endorsements</a></div>
              </div><div class="dropdown">
                <input type="checkbox" id="dropdown-trigger-resources" class="dropdown-trigger" />
                <label for="dropdown-trigger-resources" class="dropbtn">Resources</label>
                <div class="dropdown-content"><a href="/pinternship/faq/">FAQ</a><a href="/pinternship/vibe/">ViBe</a><a href="/pinternship/hp/">Health Points</a><a href="/pinternship/git-guide/">GitHub Guide</a><a href="/pinternship/protocols_and_policies/">Protocols and Policies</a></div>
              </div></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">
  
  
  

  
  
    
      
      

  
  
    <nav style="display:flex; justify-content:space-between; align-items:center; gap:1rem; padding:1rem 0;">
      <div style="flex:1; text-align:left;">
        
      </div>
      <div style="flex:1; text-align:right;">
        
        
          
          
          <a href="/pinternship/case-studies/02-crud-operations/" style="text-decoration:none; font-size:1.1em;">
            →
          </a>
        
      </div>
    </nav>
  

  <header class="post-header">
    <h1 class="post-title">Aggregation Framework</h1>
    <p class="post-description">Learn about MongoDB Aggregation Framework: $match, $group, $project, and Pipeline Stages</p>
  </header>

  <div class="post-content">
    <h2 id="1-problem-statement">1. Problem Statement</h2>

<h2 id="case-study-movieflix-analytics"><strong>Case Study: MovieFlix Analytics</strong></h2>

<p>MovieFlix, a global movie streaming platform, wants to:</p>

<ul>
  <li>
    <p>Find the most popular genres and top-rated movies in each country.</p>
  </li>
  <li>
    <p>Calculate average watch times, total views per genre, and revenue by region.</p>
  </li>
  <li>
    <p>Generate business dashboards and user recommendations, all from millions of viewing records.</p>
  </li>
</ul>

<p><img src="https://i.postimg.cc/Y9DY4NVg/react.png" alt="Sample Image" /></p>

<p><strong>The challenge:</strong><br />
How can MovieFlix efficiently analyze, summarize, and transform huge volumes of streaming data—without exporting it to another system or writing complex, slow code?</p>

<hr />

<h2 id="2-learning-objectives">2. Learning Objectives</h2>

<p>By the end of this tutorial, you will:</p>

<ul>
  <li>Understand what the MongoDB Aggregation Framework is and why it’s powerful.
 ```js</li>
  <li>Build multi-stage aggregation pipelines using  <code class="language-plaintext highlighter-rouge">$match</code>,  <code class="language-plaintext highlighter-rouge">$group</code>,  <code class="language-plaintext highlighter-rouge">$project</code>, and more.
 ```</li>
  <li>
    <p>Use pipeline stages to filter, group, reshape, and analyze data.</p>
  </li>
  <li>Apply best practices for performance and maintainability.</li>
</ul>

<hr />

<h2 id="3-concept-introduction-with-analogy">3. Concept Introduction with Analogy</h2>

<h2 id="analogy-the-data-conveyor-belt"><strong>Analogy: The Data Conveyor Belt</strong></h2>

<p>Imagine MovieFlix’s analytics as a high-tech conveyor belt in a mailroom:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span>   <span class="nx">Each</span> <span class="nf">letter </span><span class="p">(</span><span class="nb">document</span><span class="p">)</span> <span class="nx">passes</span> <span class="nx">through</span> <span class="nx">a</span> <span class="nx">series</span> <span class="k">of</span> <span class="nf">stations </span><span class="p">(</span><span class="nx">pipeline</span> <span class="nx">stages</span><span class="p">).</span>
    
<span class="o">-</span>   <span class="nx">Some</span> <span class="nx">stations</span> <span class="nx">filter</span> <span class="nx">out</span> <span class="nx">junk</span> <span class="nf">mail </span><span class="p">(</span><span class="s2">`$match`</span><span class="p">).</span>
    
<span class="o">-</span>   <span class="nx">Others</span> <span class="nx">sort</span> <span class="nx">mail</span> <span class="nx">into</span> <span class="nx">bins</span> <span class="nx">by</span> <span class="nx">city</span> <span class="nx">or</span> <span class="nf">sender </span><span class="p">(</span><span class="s2">`$group`</span><span class="p">).</span>
    
<span class="o">-</span>   <span class="nx">Some</span> <span class="nx">reformat</span> <span class="nx">addresses</span> <span class="nx">or</span> <span class="nx">add</span> <span class="nf">labels </span><span class="p">(</span><span class="s2">`$project`</span><span class="p">).</span>
</code></pre></div></div>
<ul>
  <li>At the end, you have exactly the summary or report you need.</li>
</ul>

<p><strong>The aggregation pipeline is this conveyor belt—each stage transforms or filters the data, step by step, until you get your answer.</strong></p>

<hr />

<h2 id="4-technical-deep-dive">4. Technical Deep Dive</h2>

<p><strong>A. What is the Aggregation Framework?</strong></p>

<ul>
  <li>
    <p>The Aggregation Framework is MongoDB’s built-in tool for advanced data analysis and transformation.</p>
  </li>
  <li>
    <p>It uses a  <strong>pipeline</strong>: an array of stages, each performing a specific operation on the documents.</p>
  </li>
  <li>
    <p>Each stage’s output becomes the next stage’s input—like a series of assembly line steps.</p>
  </li>
</ul>

<p><strong>Pipeline Syntax:</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">$match</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">$project</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="p">},</span>
  <span class="c1">// ...more stages</span>
<span class="p">])</span>

</code></pre></div></div>
<ul>
  <li>Pipelines can have any number of stages, in any order</li>
</ul>

<hr />

<h2 id="b-key-pipeline-stages"><strong>B. Key Pipeline Stages</strong></h2>

<h2 id="1-match-filtering-documents"><strong>1. $match: Filtering Documents</strong></h2>

<ul>
  <li>
    <p>Like a query filter; selects only documents that meet criteria.</p>
  </li>
  <li>
    <p>Should be placed early for efficiency.</p>
  </li>
</ul>

<p><strong>Example:</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nl">$match</span><span class="p">:</span> <span class="p">{</span> <span class="na">country</span><span class="p">:</span> <span class="dl">"</span><span class="s2">USA</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gte</span><span class="p">:</span> <span class="mi">8</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>Filters for US movies with rating 8 or higher.</li>
</ul>

<hr />

<p><strong>2. $group: Aggregating Data</strong></p>

<ul>
  <li>
    <p>Groups documents by a field (or expression) and computes aggregates (sum, avg, count, etc.).</p>
  </li>
  <li>
    <p>The  <code class="language-plaintext highlighter-rouge">_id</code>  field specifies the group key.</p>
  </li>
</ul>

<p><strong>Example:</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nl">$group</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$genre</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">totalViews</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$views</span><span class="dl">"</span> <span class="p">},</span>
    <span class="na">avgRating</span><span class="p">:</span> <span class="p">{</span> <span class="na">$avg</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$rating</span><span class="dl">"</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>Groups by genre, calculates total views and average rating per genre.</li>
</ul>

<hr />

<p><strong>3. $project: Shaping Output</strong></p>

<ul>
  <li>
    <p>Reshapes documents, includes/excludes fields, computes new fields.</p>
  </li>
  <li>
    <p>Can rename, transform, or format fields.</p>
  </li>
</ul>

<p><strong>Example:</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nl">$project</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">genre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$_id</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">totalViews</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">avgRating</span><span class="p">:</span> <span class="p">{</span> <span class="na">$round</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">$avgRating</span><span class="dl">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>Outputs only genre, totalViews, and a rounded avgRating.</li>
</ul>

<hr />

<p><strong>4. Other Useful Stages</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span>   <span class="s2">`$sort`</span><span class="p">:</span> <span class="nx">Orders</span> <span class="nf">documents </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.,</span> <span class="nx">by</span> <span class="nx">totalViews</span> <span class="nx">descending</span><span class="p">).</span>
    
<span class="o">-</span>   <span class="s2">`$limit`</span><span class="p">:</span> <span class="nx">Restricts</span> <span class="nx">the</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">output</span> <span class="nx">documents</span><span class="p">.</span>
    
<span class="o">-</span>   <span class="s2">`$unwind`</span><span class="p">:</span> <span class="nx">Deconstructs</span> <span class="nx">arrays</span> <span class="nx">into</span> <span class="nx">separate</span> <span class="nx">documents</span><span class="p">.</span>
    
<span class="o">-</span>   <span class="s2">`$addFields`</span><span class="p">:</span> <span class="nx">Adds</span> <span class="nx">computed</span> <span class="nx">fields</span><span class="p">.</span>
</code></pre></div></div>

<hr />

<p><strong>5. How the Pipeline Works</strong></p>

<ul>
  <li>
    <p>Documents flow through each stage in order.</p>
  </li>
  <li>
    <p>Each stage can filter, group, sort, or reshape data.</p>
  </li>
  <li>
    <p>The output of the last stage is your final result.</p>
  </li>
</ul>

<hr />

<p><strong>C. Aggregation Pipeline Example</strong></p>

<p>Suppose MovieFlix wants to find the top 3 genres by total views in 2024:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">watchHistory</span><span class="p">.</span><span class="nf">aggregate</span><span class="p">([</span>
  <span class="c1">// 1. Only 2024 records</span>
  <span class="p">{</span> <span class="na">$match</span><span class="p">:</span> <span class="p">{</span> <span class="na">year</span><span class="p">:</span> <span class="mi">2024</span> <span class="p">}</span> <span class="p">},</span>
  <span class="c1">// 2. Group by genre, sum views</span>
  <span class="p">{</span> <span class="na">$group</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$genre</span><span class="dl">"</span><span class="p">,</span> <span class="na">totalViews</span><span class="p">:</span> <span class="p">{</span> <span class="na">$sum</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$views</span><span class="dl">"</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
  <span class="c1">// 3. Sort by totalViews descending</span>
  <span class="p">{</span> <span class="na">$sort</span><span class="p">:</span> <span class="p">{</span> <span class="na">totalViews</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">},</span>
  <span class="c1">// 4. Limit to top 3</span>
  <span class="p">{</span> <span class="na">$limit</span><span class="p">:</span> <span class="mi">3</span> <span class="p">},</span>
  <span class="c1">// 5. Project clean output</span>
  <span class="p">{</span> <span class="na">$project</span><span class="p">:</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">genre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">$_id</span><span class="dl">"</span><span class="p">,</span> <span class="na">totalViews</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">])</span>
</code></pre></div></div>
<p><strong>Explanation:</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span>   <span class="s2">`$match`</span><span class="p">:</span> <span class="nx">Filters</span> <span class="k">for</span> <span class="mi">2024</span><span class="p">.</span>
    
<span class="o">-</span>   <span class="s2">`$group`</span><span class="p">:</span> <span class="nx">Sums</span> <span class="nx">up</span> <span class="nx">views</span> <span class="nx">per</span> <span class="nx">genre</span><span class="p">.</span>
    
<span class="o">-</span>   <span class="s2">`$sort`</span>  <span class="nx">and</span>  <span class="s2">`$limit`</span><span class="p">:</span> <span class="nx">Gets</span> <span class="nx">top</span> <span class="mi">3</span> <span class="nx">genres</span><span class="p">.</span>
    
<span class="o">-</span>   <span class="s2">`$project`</span><span class="p">:</span> <span class="nx">Formats</span> <span class="nx">output</span> <span class="k">for</span> <span class="nx">reporting</span><span class="p">.</span>
</code></pre></div></div>

<hr />

<p><strong>D. Best Practices for Aggregation Pipelines</strong></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span>   <span class="o">**</span><span class="nx">Place</span>  <span class="s2">`$match`</span>  <span class="nx">early</span><span class="o">**</span>  <span class="nx">to</span> <span class="nx">reduce</span> <span class="nx">data</span> <span class="nx">volume</span> <span class="k">for</span> <span class="nx">later</span> <span class="nx">stages</span><span class="p">.</span>
</code></pre></div></div>
<ul>
  <li>
    <p><strong>Use indexes</strong>  on fields used in  <code class="language-plaintext highlighter-rouge">$match</code>  for performance.</p>
  </li>
  <li>
    <p><strong>Keep documents small</strong>—avoid unnecessary fields with  <code class="language-plaintext highlighter-rouge">$project</code>.</p>
  </li>
  <li>
    <p><strong>Test each stage</strong>  separately to debug and optimize.</p>
  </li>
  <li>
    <p><strong>Limit pipeline complexity</strong>  for maintainability.</p>
  </li>
</ul>

<hr />

<h2 id="5-step-by-step-data-modeling--code-walkthrough">5. Step-by-Step Data Modeling &amp; Code Walkthrough</h2>

<p>Let’s build a real MovieFlix aggregation pipeline.</p>

<hr />

<p><strong>A. Sample Document Structure</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"_id"</span><span class="p">:</span><span class="w"> </span><span class="err">ObjectId(</span><span class="s2">"..."</span><span class="err">)</span><span class="p">,</span><span class="w">
  </span><span class="nl">"movie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Edge of Tomorrow"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"genre"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sci-Fi"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"views"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rating"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"year"</span><span class="p">:</span><span class="w"> </span><span class="mi">2024</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p><strong>B. Find the Average Rating and Total Views per Genre in the USA</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">db.watchHistory.aggregate(</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$match:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">country:</span><span class="w"> </span><span class="s2">"USA"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$group:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="err">_id:</span><span class="w"> </span><span class="s2">"$genre"</span><span class="p">,</span><span class="w">
      </span><span class="err">totalViews:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$sum:</span><span class="w"> </span><span class="s2">"$views"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="err">avgRating:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$avg:</span><span class="w"> </span><span class="s2">"$rating"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$project:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="err">_id:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="err">genre:</span><span class="w"> </span><span class="s2">"$_id"</span><span class="p">,</span><span class="w">
      </span><span class="err">totalViews:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="err">avgRating:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$round:</span><span class="w"> </span><span class="p">[</span><span class="s2">"$avgRating"</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="err">)</span><span class="w">
</span></code></pre></div></div>
<p><strong>Explanation:</strong></p>

<ul>
  <li>
    <p>Filters for USA records.</p>
  </li>
  <li>
    <p>Groups by genre.</p>
  </li>
  <li>
    <p>Sums views and averages ratings.</p>
  </li>
  <li>
    <p>Projects a clean, rounded output.</p>
  </li>
</ul>

<hr />

<p><strong>C. Find Top 5 Movies by Views in 2024</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">db.watchHistory.aggregate(</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$match:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">year:</span><span class="w"> </span><span class="mi">2024</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$sort:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">views:</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$limit:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$project:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">_id:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">movie:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">views:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="err">)</span><span class="w">
</span></code></pre></div></div>
<p><strong>D. Count Movies per Genre with $group and $project</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">db.watchHistory.aggregate(</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$group:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">_id:</span><span class="w"> </span><span class="s2">"$genre"</span><span class="p">,</span><span class="w"> </span><span class="err">count:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$sum:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">$project:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">_id:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">genre:</span><span class="w"> </span><span class="s2">"$_id"</span><span class="p">,</span><span class="w"> </span><span class="err">count:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="err">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="6-interactive-challenge--mini-project">6. Interactive Challenge / Mini-Project</h2>

<p><strong>Your Turn!</strong></p>

<ul>
  <li>
    <p>Write an aggregation pipeline to find the average rating for each genre in 2024, but only include genres with more than 10,000 total views.</p>
  </li>
  <li>
    <p>Output should show genre, average rating (rounded to 1 decimal), and total views.</p>
  </li>
</ul>

<hr />
<h2 id="7-common-pitfalls--best-practices">7. Common Pitfalls &amp; Best Practices</h2>

<table>
  <thead>
    <tr>
      <th>Pitfall</th>
      <th>Best Practice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Placing <code class="language-plaintext highlighter-rouge">$match</code> late</td>
      <td>Put <code class="language-plaintext highlighter-rouge">$match</code> early to reduce data volume</td>
    </tr>
    <tr>
      <td>Returning too many fields</td>
      <td>Use <code class="language-plaintext highlighter-rouge">$project</code> to limit output</td>
    </tr>
    <tr>
      <td>Not using indexes</td>
      <td>Index fields used in <code class="language-plaintext highlighter-rouge">$match</code> for speed</td>
    </tr>
    <tr>
      <td>Complex pipelines in one go</td>
      <td>Build and test one stage at a time</td>
    </tr>
  </tbody>
</table>

<h2 id="8-optional-programmers-workflow-checklist">8. Optional: Programmer’s Workflow Checklist</h2>

<ul>
  <li>
    <p>Define your output and work backwards to design stages.</p>
  </li>
  <li>
    <p>Place  <code class="language-plaintext highlighter-rouge">$match</code>  as early as possible.</p>
  </li>
  <li>
    <p>Use  <code class="language-plaintext highlighter-rouge">$group</code>  for aggregation,  <code class="language-plaintext highlighter-rouge">$project</code>  for shaping output.</p>
  </li>
  <li>
    <p>Test each stage’s output before adding the next.</p>
  </li>
  <li>
    <p>Use  <code class="language-plaintext highlighter-rouge">$sort</code>  and  <code class="language-plaintext highlighter-rouge">$limit</code>  for ranking and pagination.</p>
  </li>
  <li>
    <p>Optimize with indexes and by limiting unnecessary fields.</p>
  </li>
</ul>

  </div>

  <hr/>

  
  
  

  
  
    
      
      

  
  
    <nav style="display:flex; justify-content:space-between; align-items:center; gap:1rem; padding:1rem 0;">
      <div style="flex:1; text-align:left;">
        
      </div>
      <div style="flex:1; text-align:right;">
        
        
          
          
          <a href="/pinternship/case-studies/02-crud-operations/" style="text-decoration:none; font-size:1.1em;">
            →
          </a>
        
      </div>
    </nav>
  
</article>

      </div>
    </main>

	<!-- The following code is commented out to remove the footer information in the default page.-->	
	<!--<footer class="site-footer h-card">
  <data class="u-url" href="/pinternship/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Pinternship</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Pinternship</li><li><a class="u-email" href="mailto:sudarshan@iitrpr.ac.in">sudarshan@iitrpr.ac.in</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/sudarshansudarshan"><svg class="svg-icon"><use xlink:href="/pinternship/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sudarshansudarshan</span></a></li><li><a href="https://www.twitter.com/sudarshaniisc"><svg class="svg-icon"><use xlink:href="/pinternship/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">sudarshaniisc</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Pinternship - A comprehensive full-stack development internship program covering the MERN stack and modern web technologies. Master TypeScript, React, Express.js, and MongoDB through hands-on case studies.</p>
      </div>
    </div>

  </div>

</footer>
-->

  </body>

</html>


<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
