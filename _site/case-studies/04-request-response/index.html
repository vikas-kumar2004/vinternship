<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Request and Response | Pinternship</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Request and Response" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1. Problem Statement: A Day at “FreshMart” Grocery Stores" />
<meta property="og:description" content="1. Problem Statement: A Day at “FreshMart” Grocery Stores" />
<link rel="canonical" href="http://localhost:4001/pinternship/case-studies/04-request-response/" />
<meta property="og:url" content="http://localhost:4001/pinternship/case-studies/04-request-response/" />
<meta property="og:site_name" content="Pinternship" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-01-28T21:55:57+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Request and Response" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2026-01-28T21:55:57+05:30","datePublished":"2026-01-28T21:55:57+05:30","description":"1. Problem Statement: A Day at “FreshMart” Grocery Stores","headline":"Request and Response","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4001/pinternship/case-studies/04-request-response/"},"url":"http://localhost:4001/pinternship/case-studies/04-request-response/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/pinternship/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4001/pinternship/feed.xml" title="Pinternship" /></head>
<head><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-87W6B0JP70"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-87W6B0JP70');
</script></head>
  <body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/pinternship/">Pinternship</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/pinternship/intro/">Introduction</a><a class="page-link" href="/pinternship/case-studies/">Case Studies</a><a class="page-link" href="/pinternship/projects/">Projects</a><div class="dropdown">
                <input type="checkbox" id="dropdown-trigger-activity" class="dropdown-trigger" />
                <label for="dropdown-trigger-activity" class="dropbtn">Activity</label>
                <div class="dropdown-content"><a href="/pinternship/linkedin_post/">LinkedIn Post</a><a href="/pinternship/blogs/">Blogs</a><a href="/pinternship/vlogs/">Vlogs</a><a href="/pinternship/endorsements/">Endorsements</a></div>
              </div><div class="dropdown">
                <input type="checkbox" id="dropdown-trigger-resources" class="dropdown-trigger" />
                <label for="dropdown-trigger-resources" class="dropbtn">Resources</label>
                <div class="dropdown-content"><a href="/pinternship/faq/">FAQ</a><a href="/pinternship/vibe/">ViBe</a><a href="/pinternship/hp/">Health Points</a><a href="/pinternship/git-guide/">GitHub Guide</a><a href="/pinternship/protocols_and_policies/">Protocols and Policies</a></div>
              </div></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">
  
  
  

  
  
    
  
    
  
    
  
    
      
      

  
  
    <nav style="display:flex; justify-content:space-between; align-items:center; gap:1rem; padding:1rem 0;">
      <div style="flex:1; text-align:left;">
        
          
          
          <a href="/pinternship/case-studies/03-http-methods-status-codes/" style="text-decoration:none; font-size:1.1em;">
            ←
          </a>
        
      </div>
      <div style="flex:1; text-align:right;">
        
        
          
          
          <a href="/pinternship/case-studies/05-routing-controllers/" style="text-decoration:none; font-size:1.1em;">
            →
          </a>
        
      </div>
    </nav>
  

  <header class="post-header">
    <h1 class="post-title">Request and Response</h1>
    <p class="post-description">Learn about Request/Response in Express</p>
  </header>

  <div class="post-content">
    <h2 id="1-problem-statement-a-day-at-freshmart-grocery-stores">1. Problem Statement: A Day at “FreshMart” Grocery Stores</h2>

<h2 id="the-crisis-at-freshmart"><strong>The Crisis at FreshMart</strong></h2>

<p>FreshMart, a bustling grocery chain, launched a digital loyalty program to reward customers. But chaos ensued:</p>

<ul>
  <li>
    <p><strong>Missing Data:</strong>  Customers tried to redeem points, but the app crashed if their profile was incomplete.</p>
  </li>
  <li>
    <p><strong>Invalid Requests:</strong>  A customer entered “1000 points” instead of “100,” redeeming $1,000 by accident.</p>
  </li>
  <li>
    <p><strong>Confusing Responses:</strong>  Staff couldn’t tell if a request failed due to a server error or invalid input.</p>
  </li>
</ul>

<p><strong>The breaking point:</strong><br />
A customer named Sarah tried to redeem points for a birthday cake. The app accepted her request but didn’t check if she had enough points. The system deducted 500 points (her entire balance), but the cake order failed because the store was out of stock. Sarah left furious, and FreshMart’s reputation tanked.</p>

<p><strong>Your mission:</strong><br />
Redesign FreshMart’s loyalty API to:</p>

<ol>
  <li>
    <p>Validate every request.</p>
  </li>
  <li>
    <p>Ensure responses are clear and structured.</p>
  </li>
  <li>
    <p>Prevent invalid data from causing errors.</p>
  </li>
</ol>

<h2 id="2-learning-objectives">2. Learning Objectives</h2>

<p>By the end of this lesson, you’ll be able to:</p>

<ul>
  <li>
    <p>Type request bodies, query params, and responses with TypeScript.</p>
  </li>
  <li>
    <p>Validate JSON data using schemas and middleware.</p>
  </li>
  <li>
    <p>Return consistent error messages and status codes.</p>
  </li>
  <li>
    <p>Use advanced Express patterns for type safety.</p>
  </li>
  <li>
    <p>Prevent bugs like Sarah’s mishap through strict validation.</p>
  </li>
</ul>

<h2 id="3-concept-introduction-with-analogy">3. Concept Introduction with Analogy</h2>

<h2 id="analogy-the-restaurant-kitchen"><strong>Analogy: The Restaurant Kitchen</strong></h2>

<p>Imagine a restaurant kitchen:</p>

<ul>
  <li>
    <p><strong>Waiters (Requests):</strong>  Take orders from customers.</p>
  </li>
  <li>
    <p><strong>Chefs (API Logic):</strong>  Prepare meals based on orders.</p>
  </li>
  <li>
    <p><strong>Quality Control (Validation):</strong>  Checks orders for completeness (e.g., “No gluten, please”).</p>
  </li>
  <li>
    <p><strong>Server (Responses):</strong>  Delivers meals or explains why an order can’t be fulfilled.</p>
  </li>
</ul>

<p><strong>How it maps to FreshMart’s API:</strong></p>

<ul>
  <li>
    <p>If a waiter (request) doesn’t specify “no gluten” (missing data), the kitchen (API) might serve a dish that makes the customer sick.</p>
  </li>
  <li>
    <p>If the chef (API) doesn’t check stock (validation), they might promise a cake they can’t deliver.</p>
  </li>
  <li>
    <p>Quality control (TypeScript types) ensures every order (request) has the right details before the kitchen starts cooking.</p>
  </li>
</ul>

<p><strong>A. Typing Requests and Responses</strong></p>

<p><strong>1. Defining Strict Interfaces</strong></p>

<p><strong>Problem:</strong>  Without types, requests like  <code class="language-plaintext highlighter-rouge">{ points: "100" }</code>  (string) might be processed as  <code class="language-plaintext highlighter-rouge">100</code>  (number), causing bugs.<br />
<strong>Solution:</strong>  Use TypeScript interfaces to enforce data shapes.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Loyalty program interfaces</span>
<span class="kr">interface</span> <span class="nx">RedeemRequest</span> <span class="p">{</span>
  <span class="nl">customerId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">points</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">ApiResponse</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">success</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">;</span>
  <span class="nl">data</span><span class="p">?:</span> <span class="nx">T</span><span class="p">;</span>
  <span class="nl">error</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>2. Typing Express  <code class="language-plaintext highlighter-rouge">Request</code>  and  <code class="language-plaintext highlighter-rouge">Response</code></strong></p>

<p>Use generics to lock down body, query, and params:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">Response</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">router</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">/redeem</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">Request</span><span class="o">&lt;</span><span class="p">{},</span> <span class="p">{},</span> <span class="nx">RedeemRequest</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">// Body type</span>
   <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="o">&lt;</span><span class="nx">ApiResponse</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">remainingPoints</span><span class="p">:</span> <span class="kr">number</span> <span class="p">}</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// Response type</span>
    <span class="c1">// ...logic...</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>
<p><strong>Why?</strong></p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">req.body</code>  is now strictly typed. Passing  <code class="language-plaintext highlighter-rouge">{ points: "100" }</code>  will throw a TypeScript error.</p>
  </li>
  <li>
    <p>The response shape is predefined, ensuring consistency.</p>
  </li>
</ul>

<p><strong>B. Validating Data with Zod</strong>
 <strong>1. Schema Validation</strong></p>

<p><strong>Problem:</strong>  TypeScript types are stripped at runtime. Malicious clients can still send invalid data.<br />
<strong>Solution:</strong>  Use Zod to validate requests at runtime.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">z</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">zod</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">RedeemSchema</span> <span class="o">=</span> <span class="nx">z</span><span class="p">.</span><span class="nf">object</span><span class="p">({</span>
  <span class="na">customerId</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nf">string</span><span class="p">().</span><span class="nf">uuid</span><span class="p">(),</span>
  <span class="na">points</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nf">number</span><span class="p">().</span><span class="nf">int</span><span class="p">().</span><span class="nf">positive</span><span class="p">(),</span>
<span class="p">});</span>

<span class="nx">router</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/redeem</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">RedeemSchema</span><span class="p">.</span><span class="nf">safeParse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span>
      <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">error</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">message</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// Proceed with validated data (result.data)</span>
<span class="p">});</span>

</code></pre></div></div>
<p><strong>2. Centralized Validation Middleware</strong>
Avoid repeating validation logic:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">RequestHandler</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">validate</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">z</span><span class="p">.</span><span class="nx">ZodTypeAny</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">schema</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">RequestHandler</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">schema</span><span class="p">.</span><span class="nf">safeParse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span> 
        <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> 
        <span class="na">error</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">message</span> 
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span> <span class="c1">// Override req.body with parsed data</span>
    <span class="nf">next</span><span class="p">();</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/redeem</span><span class="dl">"</span><span class="p">,</span> <span class="nf">validate</span><span class="p">(</span><span class="nx">RedeemSchema</span><span class="p">),</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// req.body is now validated and typed!</span>
<span class="p">});</span>

</code></pre></div></div>
<p><strong>C. Structured Error Handling</strong>
<strong>1. Error Hierarchy</strong></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Define</span> <span class="nx">custom</span> <span class="nx">errors</span> <span class="k">for</span> <span class="nx">clarity</span><span class="p">:</span>

<span class="kd">class</span> <span class="nc">ApiError</span> <span class="kd">extends</span> <span class="nc">Error</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span>
    <span class="k">public</span> <span class="nx">statusCode</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
    <span class="nx">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="k">public</span> <span class="nx">details</span><span class="p">?:</span> <span class="kr">any</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">InsufficientPointsError</span> <span class="kd">extends</span> <span class="nc">ApiError</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Insufficient points</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p><strong>2. Global Error Middleware</strong></p>

<p>Catch all errors and send consistent responses:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">((</span><span class="nx">err</span><span class="p">:</span> <span class="nb">Error</span><span class="p">,</span> <span class="nx">req</span><span class="p">:</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">,</span> <span class="nx">next</span><span class="p">:</span> <span class="nx">NextFunction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">err</span> <span class="k">instanceof</span> <span class="nx">ApiError</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span>
      <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">error</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
      <span class="na">details</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">details</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Log unexpected errors but don’t expose details</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span> 
      <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> 
      <span class="na">error</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span> 
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>
<p><strong>Usage in routes:</strong></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">router</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/redeem</span><span class="dl">"</span><span class="p">,</span> <span class="nf">validate</span><span class="p">(</span><span class="nx">RedeemSchema</span><span class="p">),</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">member</span> <span class="o">=</span> <span class="nf">findMember</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">customerId</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">member</span><span class="p">.</span><span class="nx">points</span> <span class="o">&lt;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">points</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nc">InsufficientPointsError</span><span class="p">();</span> <span class="c1">// Caught by global middleware</span>
  <span class="p">}</span>
  <span class="c1">// ...redeem points...</span>
<span class="p">});</span>
</code></pre></div></div>

<p><strong>D. Advanced: Custom Request Properties</strong></p>

<p><strong>1. Extending  <code class="language-plaintext highlighter-rouge">Request</code>  for Authentication</strong></p>

<p>Add user data to  <code class="language-plaintext highlighter-rouge">req</code>  after authentication:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">declare</span> <span class="nb">global</span> <span class="p">{</span>
  <span class="k">namespace</span> <span class="nx">Express</span> <span class="p">{</span>
    <span class="kr">interface</span> <span class="nx">Request</span> <span class="p">{</span>
      <span class="nl">user</span><span class="p">?:</span> <span class="p">{</span>
        <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">role</span><span class="p">:</span> <span class="dl">"</span><span class="s2">customer</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Auth middleware</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">use</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">authorization</span><span class="p">;</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nf">decodeToken</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span> <span class="c1">// Assume this returns a user object</span>
  <span class="p">}</span>
  <span class="nf">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// Usage in routes</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/profile</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nc">ApiError</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Unauthorized</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">success</span><span class="dl">"</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span> <span class="p">});</span>
<span class="p">});</span>

</code></pre></div></div>
<p><strong>E. Real-World Example: Full Redeem Endpoint</strong></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">router</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">/redeem</span><span class="dl">"</span><span class="p">,</span>
  <span class="nf">validate</span><span class="p">(</span><span class="nx">RedeemSchema</span><span class="p">),</span>
  <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">Request</span><span class="o">&lt;</span><span class="p">{},</span> <span class="p">{},</span> <span class="nx">RedeemRequest</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">customerId</span><span class="p">,</span> <span class="nx">points</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

    <span class="c1">// Check customer exists</span>
    <span class="kd">const</span> <span class="nx">member</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">loyaltyMembers</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span> <span class="nx">customerId</span> <span class="p">});</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">member</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">ApiError</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Customer not found</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Check points</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">member</span><span class="p">.</span><span class="nx">points</span> <span class="o">&lt;</span> <span class="nx">points</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">InsufficientPointsError</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Check item availability</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span> <span class="na">sku</span><span class="p">:</span> <span class="dl">"</span><span class="s2">CAKE</span><span class="dl">"</span> <span class="p">});</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">item</span> <span class="o">||</span> <span class="nx">item</span><span class="p">.</span><span class="nx">stock</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">ApiError</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Item out of stock</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Deduct points and update inventory</span>
    <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">loyaltyMembers</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">(</span>
      <span class="p">{</span> <span class="nx">customerId</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">$inc</span><span class="p">:</span> <span class="p">{</span> <span class="na">points</span><span class="p">:</span> <span class="o">-</span><span class="nx">points</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">);</span>
    <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nf">updateOne</span><span class="p">({</span> <span class="na">sku</span><span class="p">:</span> <span class="dl">"</span><span class="s2">CAKE</span><span class="dl">"</span> <span class="p">},</span> <span class="p">{</span> <span class="na">$inc</span><span class="p">:</span> <span class="p">{</span> <span class="na">stock</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">});</span>

    <span class="c1">// Success!</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span>
      <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">success</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span> 
        <span class="nx">customerId</span><span class="p">,</span> 
        <span class="na">remainingPoints</span><span class="p">:</span> <span class="nx">member</span><span class="p">.</span><span class="nx">points</span> <span class="o">-</span> <span class="nx">points</span><span class="p">,</span>
        <span class="na">item</span><span class="p">:</span> <span class="dl">"</span><span class="s2">CAKE</span><span class="dl">"</span> 
      <span class="p">},</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">);</span>

</code></pre></div></div>
<h2 id="5-step-by-step-data-flow">5. Step-by-Step Data Flow</h2>

<ol>
  <li>
    <p><strong>Request Received:</strong></p>

    <ul>
      <li>Client sends  <code class="language-plaintext highlighter-rouge">POST /redeem</code>  with  <code class="language-plaintext highlighter-rouge">{ customerId: "123", points: 500 }</code>.</li>
    </ul>
  </li>
  <li>
    <p><strong>Validation Middleware:</strong></p>

    <ul>
      <li>
        <p>Zod checks if  <code class="language-plaintext highlighter-rouge">points</code>  is a positive integer.</p>
      </li>
      <li>
        <p>If invalid, returns  <code class="language-plaintext highlighter-rouge">400 Bad Request</code>  with error details.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Authentication Middleware:</strong></p>

    <ul>
      <li>Checks  <code class="language-plaintext highlighter-rouge">Authorization</code>  header and attaches  <code class="language-plaintext highlighter-rouge">req.user</code>.</li>
    </ul>
  </li>
  <li>
    <p><strong>Business Logic:</strong></p>

    <ul>
      <li>
        <p>Checks customer existence, points, and inventory.</p>
      </li>
      <li>
        <p>Throws specific errors for each failure case.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Global Error Handler:</strong></p>

    <ul>
      <li>Catches errors and sends structured responses.</li>
    </ul>
  </li>
  <li>
    <p><strong>Success Response:</strong></p>

    <ul>
      <li>Returns  <code class="language-plaintext highlighter-rouge">200 OK</code>  with remaining points and redeemed item.</li>
    </ul>
  </li>
</ol>

<h2 id="6-interactive-challenge">6. Interactive Challenge</h2>

<p><strong>Your Turn!</strong></p>

<ol>
  <li>
    <p>Add a  <code class="language-plaintext highlighter-rouge">POST /transfer</code>  endpoint allowing customers to transfer points to another account.</p>
  </li>
  <li>
    <p>Validate:</p>

    <ul>
      <li>
        <p>Both  <code class="language-plaintext highlighter-rouge">fromCustomerId</code>  and  <code class="language-plaintext highlighter-rouge">toCustomerId</code>  must be valid UUIDs.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">points</code>  must be a positive integer.</p>
      </li>
      <li>
        <p>The sender must have enough points.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Return appropriate errors for each failure case.</p>
  </li>
</ol>

<h2 id="7-common-pitfalls--best-practices">7. Common Pitfalls &amp; Best Practices</h2>

<table>
  <thead>
    <tr>
      <th>Pitfall</th>
      <th>Best Practice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Using any for request bodies</td>
      <td>Always type with interfaces/Zod schemas</td>
    </tr>
    <tr>
      <td>Ignoring runtime validation</td>
      <td>Use Zod even if TypeScript is enabled</td>
    </tr>
    <tr>
      <td>Generic error messages</td>
      <td>Throw specific errors (e.g., InsufficientPointsError)</td>
    </tr>
    <tr>
      <td>Mixing response formats</td>
      <td>Standardize responses with ApiResponse</td>
    </tr>
  </tbody>
</table>

<h2 id="8-quick-recap--key-takeaways">8. Quick Recap &amp; Key Takeaways</h2>

<ul>
  <li>
    <p><strong>Type Everything:</strong>  From request bodies to custom  <code class="language-plaintext highlighter-rouge">Request</code>  properties.</p>
  </li>
  <li>
    <p><strong>Validate at Runtime:</strong>  TypeScript isn’t enough-Zod catches malicious data.</p>
  </li>
  <li>
    <p><strong>Structured Errors:</strong>  Use custom errors and global middleware for consistency.</p>
  </li>
  <li>
    <p><strong>Centralized Logic:</strong>  Middleware for auth/validation reduces code duplication.</p>
  </li>
</ul>

<h2 id="9-optional-programmers-workflow-checklist">9. Optional: Programmer’s Workflow Checklist</h2>

<ul>
  <li>
    <p>Define Zod schemas for all incoming data.</p>
  </li>
  <li>
    <p>Use  <code class="language-plaintext highlighter-rouge">ApiResponse</code>  for all JSON responses.</p>
  </li>
  <li>
    <p>Throw  <code class="language-plaintext highlighter-rouge">ApiError</code>  or subclasses for known failures.</p>
  </li>
  <li>
    <p>Test edge cases: invalid UUIDs, negative points, etc.</p>
  </li>
  <li>
    <p>Log unexpected errors but don’t expose details.</p>
  </li>
</ul>

  </div>

  <hr/>

  
  
  

  
  
    
  
    
  
    
  
    
      
      

  
  
    <nav style="display:flex; justify-content:space-between; align-items:center; gap:1rem; padding:1rem 0;">
      <div style="flex:1; text-align:left;">
        
          
          
          <a href="/pinternship/case-studies/03-http-methods-status-codes/" style="text-decoration:none; font-size:1.1em;">
            ←
          </a>
        
      </div>
      <div style="flex:1; text-align:right;">
        
        
          
          
          <a href="/pinternship/case-studies/05-routing-controllers/" style="text-decoration:none; font-size:1.1em;">
            →
          </a>
        
      </div>
    </nav>
  
</article>

      </div>
    </main>

	<!-- The following code is commented out to remove the footer information in the default page.-->	
	<!--<footer class="site-footer h-card">
  <data class="u-url" href="/pinternship/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Pinternship</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Pinternship</li><li><a class="u-email" href="mailto:sudarshan@iitrpr.ac.in">sudarshan@iitrpr.ac.in</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/sudarshansudarshan"><svg class="svg-icon"><use xlink:href="/pinternship/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sudarshansudarshan</span></a></li><li><a href="https://www.twitter.com/sudarshaniisc"><svg class="svg-icon"><use xlink:href="/pinternship/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">sudarshaniisc</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Pinternship - A comprehensive full-stack development internship program covering the MERN stack and modern web technologies. Master TypeScript, React, Express.js, and MongoDB through hands-on case studies.</p>
      </div>
    </div>

  </div>

</footer>
-->

  </body>

</html>


<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
